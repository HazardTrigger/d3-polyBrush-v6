!function(t){t.polyBrush=function(){let n=t.dispatch("start","brush","end"),e=null,l=null,r=null,u=[],o=!0,i=!0,s=!1,c=null,h=t.line().x(t=>t[0]).y(t=>t[1]),a=function(n){e=n,n.each(function(){let e,o,i;e=(n=t.select(this).style("pointer-events","all").on("click.brush",m)).selectAll(".background").data([0]).join("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),i=n.selectAll(".extent").data([u]).join("path").attr("class","extent").style("cursor","move"),l&&(o=g(l.range()),e.attr("x",o[0]).attr("width",o[1]-o[0])),r&&(o=g(r.range()),e.attr("y",o[0]).attr("height",o[1]-o[0]))})},f=function(){return e.each(function(){t.select(this).selectAll("g path").attr("d",function(t){return h(t)+"Z"})})},g=function(t){let n=t[0],e=t[t.length-1];return n<e?[n,e]:[e,n]},d=function(t){let n=g(l.range()),e=g(r.range()),u=Math.max(n[0],Math.min(n[1],t[0])),o=Math.max(e[0],Math.min(e[1],t[1]));return t[0]===u&&t[1]===o},p=function(){return t.select(window).on("dblclick.brush",null).on("mousemove.brush",null),o=!0,2===u.length&&u[0][0]===u[1][0]&&u[0][1]===u[1][1]&&u.splice(0,u.length),t.select(".extent").on("mousedown.brush",y),n.call("end",this)},m=function(e){t.select(this);let l=t.select(window);if(i=!0,!s)return o&&(u.splice(0,u.length),o=!1,t.select(".extent").on("mousedown.brush",null),l.on("mousemove.brush",function(t){return function(t){let e=[t.layerX,t.layerY];i?(u.push(e),i=!1):(d(e)&&u.splice(u.length-1,1,e),f(),n.call("brush",this))}(t)}).on("dblclick.brush",p),n.call("start",this)),u.length>1&&u.pop(),u.push(t.pointer(e)),f();s=!1},b=function(){return t.select(window).on("mousemove.brush",null).on("mouseup.brush",null),s=!0,n.call("end",this)},y=function(e){e.stopPropagation(),e.preventDefault(),o&&!a.empty()&&(t.select(window).on("mousemove.brush",function(t){return function(t){let e,l,r,o,i,s,h,a,g,p,m;for(o=[t.layerX,t.layerY],i=o[0]-c[0],s=o[1]-c[1],l=!1,c=o,h=function(t){t[0]+=i,t[1]+=s},a=0,p=u.length;a<p;a++)h(r=u[a]);for(e=function(t){return d(t)||(l=!0),l},g=0,m=u.length;g<m;g++)e(r=u[g]);if(!l)return f(),n.call("brush",this,{mode:"move"})}(t)}).on("mouseup.brush",b),c=t.pointer(e))};return a.isWithinExtent=function(t,n){let e,l,r,o,i,s,c,h;for(l=(r=u.length)-1,s=!1,e=c=0,h=u.length;c<h;e=++c)o=u[e],i=u[l],o[1]>n!=i[1]>n&&t<(i[0]-o[0])*(n-o[1])/(i[1]-o[1])+o[0]&&(s=!s),l=e;return s},a.x=function(t){return arguments.length?(l=t,a):l},a.y=function(t){return arguments.length?(r=t,a):r},a.extent=function(t){return arguments.length?(u=t,a):u},a.clear=function(){return u.splice(0,u.length),a},a.empty=function(){return 0===u.length},a.on=function(t,e){return n.on(t,e),a},a}}(d3);